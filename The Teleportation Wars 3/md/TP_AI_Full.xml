<?xml version="1.0" encoding="utf-8"?>
<mdscript name="TP_AI_Full" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="D:/x4 extract 2.0b1/libraries/md.xsd">
    <cues>
        <!-- 
        storage
        exchange might work
        math
        check case mismatch
        
         -->
        <cue name="Init_AI" instantiate="true">
            <conditions>
                <event_cue_signalled cue="md.Setup.GameStart" />
            </conditions>
            <actions>
                <!-- find -->
                <find_sector groupname="$TP_Sectors" space="player.galaxy" multiple="true" />
                <find_sector groupname="$TP_Sectors_Argon" space="player.galaxy" multiple="true" owner="faction.argon" />
                <find_sector groupname="$TP_Sectors_Teladi" space="player.galaxy" multiple="true" owner="faction.teladi" />
                <find_sector groupname="$TP_Sectors_Paranid" space="player.galaxy" multiple="true" owner="faction.paranid" />
                <find_sector groupname="$TP_Sectors_antigone" space="player.galaxy" multiple="true" owner="faction.antigone" />
                <find_sector groupname="$TP_Sectors_ministry" space="player.galaxy" multiple="true" owner="faction.teladi" />
                <find_sector groupname="$TP_Sectors_holyorder" space="player.galaxy" multiple="true" owner="faction.holyorder" />
                <find_sector groupname="$TP_Sectors_ownerless" space="player.galaxy" multiple="true" owner="faction.ownerless" />
                <!-- group -->
                <create_group groupname="$SpawnedShip" />
                <create_group groupname="$SpawnedStationGroup" />
                <create_group groupname="$SpawnedFactoriesGroup" />
                <create_group groupname="$TeleportationBeacons" />
                <create_group groupname="$TeleportationStations" />
                <create_group groupname="$SpawnedStationGroup" />
                <!-- modules -->
                <create_list name="$Prod" />
                <create_list name="$Con" />
                <create_list name="$Stor" />
                <get_module_definition tags="[tag.production]" faction="faction.argon" macro="$Resultprod" multiple="true" />
                <get_module_definition tags="[tag.connection]" faction="faction.argon" macro="$Resultcon" multiple="true" />
                <get_module_definition tags="[tag.storage]" faction="faction.argon" macro="$Resultstorage" multiple="true" />
                <!-- make a faction for all the tradwares? -->
                <get_ware_definition faction="faction.argon" result="$AllWares" />
                <!-- tables -->
                <set_value name="$FleetTable" exact="table[]" />
                <!-- xenonai -->
                <set_value name="$ForcePool" exact="50" />
                <set_value name="$OldForcePool" exact="0"/>
                <set_value name="$ConstantFleetHop" exact="2f" />
                <set_value name="$ConstantPlayerAttack" exact="1f" />
                <set_value name="$ConstantInvasion" exact="10f" />
                <set_value name="$BeaconRate" exact="2f" />
                <!--******************************VALUES*******************************  -->
                <set_value name="$PHQ" exact="1f" />
                <set_value name="$Time" exact="(player.age)f + 20" />
                <set_value name="$DeltaTime" exact="$Time" />
                <!--******************************CALC VALUES*******************************  -->
                <set_value name="$FleetHop" exact="2" />
                <set_value name="$Invasion" exact="2" />
                <set_value name="$PlayerAttack" exact="2" />
                <set_value name="$Piratehop" exact="2" />
                <set_value name="$XenonForce" exact="2" />
                <set_value name="$XenonSuccess" exact="2f" />
                <set_value name="$PlayerSuccess" exact="1f" />
                <!--  ******************************xenonactions*******************************   -->
                <set_value name="$FleetHopSelected" exact="false" />
                <set_value name="$InvasionSelected" exact="false" />
                <set_value name="$InvasionStart" exact="false" />
                <set_value name="$InvasionStations" exact="0" />
                <!--  ******************************spawn*******************************   -->
                <set_value name="$MediumSearchComplete" exact="false" />
                <set_value name="$SearchComplete" exact="false" />
                <set_value name="$LargeSearchComplete" exact="false" />
            </actions>
            <cues>
                <cue name="TP_Report" instantiate="true" checktime="45s" checkinterval="60s">
                    <actions>
                        <!-- report -->
                        <set_value name="$ReportCount" exact="1" operation="add" />
                        <debug_to_file text="'Report: ' + $ReportCount" name="'TP_Report.log'" />
                        <debug_to_file text="'FleetHop ' + $FleetHop" name="'TP_Report.log'" />
                        <debug_to_file text="'PlayerAttack ' + $PlayerAttack" name="'TP_Report.log'" />
                        <debug_to_file text="'Invasion ' + $Invasion" name="'TP_Report.log'" />
                        <debug_to_file text="'ForcePool ' + $ForcePool" name="'TP_Report.log'" />
                        <debug_to_file text="'DeltaTime ' + $DeltaTime" name="'TP_Report.log'" />
                        <debug_to_file text="'Utilization ' + $Utilization" name="'TP_Report.log'" />
                        <debug_to_file text="'Fleet Report '" name="'TP_Report.log'" />
                        <debug_to_file text="'Total Fleets ' + $FleetTable.keys.count" name="'TP_Report.log'" />
                        <do_all exact="$FleetTable.keys.count" counter="$thisfleet">
                            <debug_to_file text="'Active Fleet? ' + $FleetTable.{$thisfleet}.$Active" name="'TP_Report.log'" />
                            <debug_to_file text="'FleetShips ' + $FleetTable.{$thisfleet}.$FleetShips.count" name="'TP_Report.log'" />
                            <debug_to_file text="'INVASION ' + $FleetTable.{$thisfleet}.$Invasion" name="'TP_Report.log'" />
                            <debug_to_file text="'FleetHop ' + $FleetTable.{$thisfleet}.$FleetHop" name="'TP_Report.log'" />
                            <debug_to_file text="'PLAYERATTACK ' + $FleetTable.{$thisfleet}.$PlayerAttack" name="'TP_Report.log'" />
                            <debug_to_file text="'Startime ' + $FleetTable.{$thisfleet}.$Startime" name="'TP_Report.log'" />
                            <!-- fix me -->
                            <do_all exact="$FleetTable.{$thisfleet}.$FleetShips.count" counter="$ship">
                                <debug_to_file text="'FleetShipNames ' + $FleetTable.{$thisfleet}.$FleetShips.{$ship}.knownname" name="'TP_Report.log'" />
                            </do_all>
                        </do_all>
                        <debug_to_file text="'Factory Report '" name="'TP_Report.log'" />
                        <debug_to_file text="'Factory Count ' + $SpawnedFactoriesGroup.count" name="'TP_Report.log'" />
                        <do_all exact="$SpawnedFactoriesGroup.count" counter="$thisfactory">
                            <debug_to_file text="'Factory Name ' + $SpawnedFactoriesGroup.{$thisfactory}.knowname" name="'TP_Report.log'" />
                            <debug_to_file text="'All Posts ' + $SpawnedFactoriesGroup.{$thisfactory}.controlposts.all" name="'TP_Report.log'" />
                            <debug_to_file text="'Empty Posts ' + $SpawnedFactoriesGroup.{$thisfactory}.controlposts.free" name="'TP_Report.log'" />
                            <debug_to_file text="'TradeWares ' + $SpawnedFactoriesGroup.{$thisfactory}.tradewares" name="'TP_Report.log'" />
                            <do_all exact="$SpawnedFactoriesGroup.{$thisfactory}.productions.count" counter="$product">
                                <debug_to_file text="'Products ' + $SpawnedFactoriesGroup.{$thisfactory}.productions.{$product}.knownname" name="'TP_Report.log'" />
                            </do_all>
                        </do_all>
                        <debug_to_file text="'Station Report '" name="'TP_Report.log'" />
                        <debug_to_file text="'Station Count ' + $SpawnedStationGroup.count" name="'TP_Report.log'" />
                        <do_all exact="$SpawnedStationGroup.count" counter="$thisfactory">
                            <debug_to_file text="'Station Name ' + $SpawnedStationGroup.{$thisfactory}.knowname" name="'TP_Report.log'" />
                            <debug_to_file text="'All Posts ' + $SpawnedStationGroup.{$thisfactory}.controlposts.all" name="'TP_Report.log'" />
                            <debug_to_file text="'Empty Posts ' + $SpawnedStationGroup.{$thisfactory}.controlposts.free" name="'TP_Report.log'" />
                            <debug_to_file text="'TradeWares ' + $SpawnedStationGroup.{$thisfactory}.tradewares" name="'TP_Report.log'" />
                            <do_all exact="$SpawnedStationGroup.{$thisfactory}.productions.count" counter="$product">
                                <debug_to_file text="'Products ' + $SpawnedStationGroup.{$thisfactory}.productions.{$product}.knownname" name="'TP_Report.log'" />
                            </do_all>
                        </do_all>
                    </actions>
                </cue>
                <cue name="BeaconRate" instantiate="true" checkinterval="60s">
                    <actions>
                        <create_object groupname="$TeleportationBeacons" macro="macro.env_deco_nav_beacon_t1_macro" sector="$TP_Sectors.random" owner="faction.ownerless">
                            <safepos min="300km" max="600km" />
                        </create_object>
                    </actions>
                </cue>
                <cue name="SpawnTradeStation" instantiate="true">
                    <delay exact="3s" />
                    <actions>
                        <do_any>
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_Argon.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_Teladi.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_Paranid.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_antigone.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_ministry.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_holyorder.random" />
                        </do_any>
                        <set_value name="$StationMacro" exact="macro.station_arg_tradestation_base_01_macro" />
                        <set_value name="$ConstructionPlan" exact="'arg_tradestation'" />
                        <set_value name="$ConstructionFaction" exact="$SectorToSpawnIn.owner" />
                        <include_actions ref="SpawnStationLIB" />
                        <remove_value name="$SectorToSpawnIn" />
                        <remove_value name="$StationMacro" />
                        <remove_value name="$ConstructionPlan" />
                        <remove_value name="$ConstructionFaction" />
                        <set_owner object="$StationSpawned" faction="faction.player" overridenpc="true" />
                    </actions>
                </cue>
                <cue name="SpawnInvasionStation" instantiate="true">
                    <conditions>
                        <event_cue_signalled />
                    </conditions>
                    <delay exact="20s" />
                    <actions>
                        <set_value name="$SectorToSpawnIn" exact="$TP_Sectors.random" />
                        <set_value name="$StationMacro" exact="macro.station_arg_tradestation_base_01_macro" />
                        <set_value name="$ConstructionPlan" exact="'arg_tradestation'" />
                        <set_value name="$ConstructionFaction" exact="faction.xenon" />
                        <include_actions ref="SpawnStationLIB" />
                        <remove_value name="$SectorToSpawnIn" />
                        <remove_value name="$StationMacro" />
                        <remove_value name="$ConstructionPlan" />
                        <remove_value name="$ConstructionFaction" />
                        <add_to_group groupname="$TeleportationStations" object="$StationSpawned" />
                        <set_owner object="$StationSpawned" faction="faction.player" overridenpc="true" />
                        <signal_cue_instantly cue="XenonInvasion" />
                        <debug_to_file text="'INVASTION STATION CUE SIGNALED INVASION '" name="'AIvalue.log'" />
                    </actions>
                </cue>
                <cue name="SpawnFactory" instantiate="true">
                    <delay exact="6s" />
                    <actions>
                        <do_any>
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_Argon.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_Teladi.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_Paranid.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_antigone.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_ministry.random" />
                            <set_value name="$SectorToSpawnIn" exact="$TP_Sectors_holyorder.random" />
                        </do_any>
                        <get_module_definition tags="[tag.production]" faction="$SectorToSpawnIn.owner" macro="$Resultprod" multiple="true" />
                        <get_module_definition tags="[tag.connection]" faction="$SectorToSpawnIn.owner" macro="$Resultcon" multiple="true" />
                        <get_module_definition tags="[tag.storage]" faction="$SectorToSpawnIn.owner" macro="$Resultstorage" multiple="true" />
                        <do_all exact="10">
                            <append_to_list name="$Prod" exact="$Resultprod.random" />
                        </do_all>
                        <do_all exact="20">
                            <append_to_list name="$Con" exact="$Resultcon.random" />
                        </do_all>
                        <do_all exact="20">
                            <append_to_list name="$Stor" exact="$Resultstorage.random" />
                        </do_all>
                        <set_value name="$StationMacro" exact="macro.station_gen_factory_base_01_macro" />
                        <set_value name="$ConstructionFaction" exact="$SectorToSpawnIn.owner" />
                        <include_actions ref="SpawnFactoryLIB" />
                        <remove_value name="$SectorToSpawnIn" />
                        <remove_value name="$StationMacro" />
                        <remove_value name="$ConstructionFaction" />
                        <set_owner object="$FactorySpawned" faction="faction.player" overridenpc="true" />
                    </actions>
                </cue>
                <cue name="AI_Force" instantiate="true" checktime="30s" checkinterval="10min">
                    <actions>
                        <set_value name="$DeltaTime" exact="($Time * 1.03f)" operation="add" />
                        <set_value name="$Utilization" exact="$XenonForce / ($XenonForce  + $Time  + $XenonSuccess )" />
                        <!-- calc -->
                        <set_value name="$FleetHop" exact="$ConstantFleetHop * ((( $XenonSuccess/$PlayerSuccess ) * ($BeaconRate * $DeltaTime)) /  $Utilization)" />
                        <set_value name="$PlayerAttack" exact="$ConstantPlayerAttack * ((( $PlayerSuccess/$XenonSuccess ) * ($PHQ * $DeltaTime)) /  $Utilization)" />
                        <set_value name="$Invasion" exact="$ConstantInvasion * ((($XenonSuccess - $Time ) * $Utilization) + $DeltaTime)" />
                        <set_value name="$ForcePool" exact="(($FleetHop + $PlayerAttack + $Invasion) / 100) - $OldForcePool" />
                        <set_value name="$OldForcePool" exact="$ForcePool" operation="add"/>
                        <debug_to_file text="'FleetHop ' + $FleetHop" name="'AIvalue.log'" />
                        <debug_to_file text="'PlayerAttack ' + $PlayerAttack" name="'AIvalue.log'" />
                        <debug_to_file text="'Invasion ' + $Invasion" name="'AIvalue.log'" />
                        <debug_to_file text="'ForcePool ' + $ForcePool" name="'AIvalue.log'" />
                        <debug_to_file text="'DeltaTime ' + $DeltaTime" name="'AIvalue.log'" />
                        <debug_to_file text="'Utilization ' + $Utilization" name="'AIvalue.log'" />
                        <!-- exchange -->
                        <do_if value="$InvasionStart == false">
                            <do_if value="$FleetHop gt $Invasion and $FleetHop gt $PlayerAttack">
                                <set_value name="$InvasionSelected" exact="false" />
                                <set_value name="$PlayerAttackSelected" exact="false" />
                                <set_value name="$FleetHopSelected" exact="true" />
                                <debug_to_file text="'FleetHop SELECTED '" name="'AIvalue.log'" />
                            </do_if>
                            <do_if value="$Invasion gt $FleetHop and $Invasion gt $PlayerAttack">
                                <set_value name="$FleetHopSelected" exact="false" />
                                <set_value name="$PlayerAttackSelected" exact="false" />
                                <set_value name="$InvasionSelected" exact="true" />
                                <debug_to_file text="'INVASION SELECTED '" name="'AIvalue.log'" />
                            </do_if>
                        </do_if>
                        <do_if value="$FleetHopSelected == true">
                            <signal_cue_instantly cue="XenonFleetHop" />
                            <debug_to_file text="'FleetHop SIGNAL '" name="'AIvalue.log'" />
                        </do_if>
                        <do_if value="$InvasionSelected == true">
                            <set_value name="$InvasionStart" exact="true" />
                            <signal_cue_instantly cue="XenonInvasion" />
                            <debug_to_file text="'INVASION SIGNAL '" name="'AIvalue.log'" />
                        </do_if>
                        <do_if value="$InvasionStations gt 0">
                            <set_value name="$InvasionStart" exact="false" />
                            <debug_to_file text="'INVASION START SIGNAL '" name="'AIvalue.log'" />
                        </do_if>
                        <debug_to_file text="'INVASION START SIGNAL ' + $InvasionStart" name="'AIvalue.log'" />
                        <debug_to_file text="'INVASION START SIGNAL ' + $InvasionStations" name="'AIvalue.log'" />
                        <do_if value="$InvasionStations == 0">
                            <debug_to_file text="'STEP ONE '" name="'AIvalue.log'" />
                            <do_if value="$InvasionSelected == true">
                                <debug_to_file text="'STEP TWO '" name="'AIvalue.log'" />
                                <do_if value="$InvasionStart == true">
                                    <debug_to_file text="'STEP THREE '" name="'AIvalue.log'" />
                                    <set_value name="$InvasionStations" exact="1" operation="add" />
                                    <signal_cue_instantly cue="SpawnInvasionStation" />
                                    <debug_to_file text="'INVASION STATION SIGNAL '" name="'AIvalue.log'" />
                                </do_if>
                            </do_if>
                        </do_if>
                    </actions>
                </cue>
                <cue name="ReturnHome" instantiate="true" checkinterval="5min">
                    <actions>
                        <!-- <set_value name="$NewEntry" exact="$FleetTable.keys.list.max + 1" />
                            <debug_text text="'MonkeyTest KeysMax ' + $FleetTable.keys.list.max" />
                            <set_value name="$FleetTable.{$NewEntry}" exact="table[
                                    $Beacon = $ShipSpawnZone,
                                    $Active = true,
                                    $FleetHop = true,
                                    $PirateHop = false,
                                    $PlayerAttack = false,
                                    $Invasion = false,
                                    $Startime = player.age,
                                    $Quant = $ForcePool,
                                    $FleetShips = [$FleetHop]
                                    ]" /> -->
                        <do_all exact="$FleetTable.keys.count" counter="$a">
                            <do_if value="$FleetTable.{$a}.$Active == true">
                                <do_if value="$FleetTable.{$a}.$FleetHop == true">
                                    <do_if value="(player.age - $FleetTable.{$a}.$Startime) gt 3min">
                                        <debug_text text="$FleetTable.{$a}.$FleetShips" />
                                        <add_to_group groupname="$EndShips" list="$FleetTable.{$a}.$FleetShips" />
                                        <destroy_group group="$EndShips" />
                                        <clear_list list="$FleetTable.{$a}.$FleetShips" />
                                        <set_value name="$FleetTable.{$a}.$Active" exact="false" />
                                        <set_value name="$FleetTable.{$a}.$Startime" exact="0" />
                                        <set_value name="$FleetTable.{$a}.$FleetHop" exact="false" />
                                    </do_if>
                                </do_if>
                                <do_if value="$FleetTable.{$a}.$PirateHop == true">
                                    <do_if value="(player.age - $FleetTable.{$a}.$Startime) gt 3min">
                                        <debug_text text="$FleetTable.{$a}.$FleetShips" />
                                        <add_to_group groupname="$EndShips" list="$FleetTable.{$a}.$FleetShips" />
                                        <destroy_group group="$EndShips" />
                                        <clear_list list="$FleetTable.{$a}.$FleetShips" />
                                        <set_value name="$FleetTable.{$a}.$Active" exact="false" />
                                        <set_value name="$FleetTable.{$a}.$Startime" exact="0" />
                                        <set_value name="$FleetTable.{$a}.$PirateHop" exact="false" />
                                    </do_if>
                                </do_if>
                                <do_if value="$FleetTable.{$a}.$PlayerAttack == true">
                                    <do_if value="(player.age - $FleetTable.{$a}.$Startime) gt 3min">
                                        <debug_text text="$FleetTable.{$a}.$FleetShips" />
                                        <add_to_group groupname="$EndShips" list="$FleetTable.{$a}.$FleetShips" />
                                        <destroy_group group="$EndShips" />
                                        <clear_list list="$FleetTable.{$a}.$FleetShips" />
                                        <set_value name="$FleetTable.{$a}.$Active" exact="false" />
                                        <set_value name="$FleetTable.{$a}.$Startime" exact="0" />
                                        <set_value name="$FleetTable.{$a}.$PlayerAttack" exact="false" />
                                    </do_if>
                                </do_if>
                                <do_if value="$FleetTable.{$a}.$Invasion == true">
                                    <do_if value="(player.age - $FleetTable.{$a}.$Startime) gt 3min">
                                        <debug_text text="$FleetTable.{$a}.$FleetShips" />
                                        <add_to_group groupname="$EndShips" list="$FleetTable.{$a}.$FleetShips" />
                                        <destroy_group group="$EndShips" />
                                        <clear_list list="$FleetTable.{$a}.$FleetShips" />
                                        <set_value name="$FleetTable.{$a}.$Active" exact="false" />
                                        <set_value name="$FleetTable.{$a}.$Startime" exact="0" />
                                        <set_value name="$FleetTable.{$a}.$Invasion" exact="false" />
                                    </do_if>
                                </do_if>
                            </do_if>
                        </do_all>
                    </actions>
                </cue>
                <cue name="XenonFleetHop" instantiate="true">
                    <conditions>
                        <event_cue_signalled />
                    </conditions>
                    <delay exact="3s" />
                    <actions>
                        <set_value name="$FactionSelected" exact="faction.xenon" />
                        <set_value name="$Owner" exact="faction.player" />
                        <set_value name="$FighterWeight" exact="50" />
                        <set_value name="$MWeight" exact="10" />
                        <set_value name="$UWeight" exact="2" />
                        <set_value name="$DWeight" exact="4" />
                        <set_value name="$CWeight" exact="1" />
                        <do_any>
                            <set_value name="$TagSelected" weight="1 + $FighterWeight" exact="tag.fighter" />
                            <set_value name="$TagSelected" weight="1 + $FighterWeight" exact="tag.fighter" />
                            <set_value name="$TagSelected" weight="1 + $FighterWeight" exact="tag.fighter" />
                            <set_value name="$TagSelected" weight="1 + $FighterWeight" exact="tag.fighter" />
                            <set_value name="$TagSelected" weight="1 + $MWeight" exact="tag.medium" />
                            <set_value name="$TagSelected" weight="1 + $UWeight" exact="tag.miner" />
                            <set_value name="$TagSelected" weight="1 + $DWeight" exact="tag.destroyer" />
                            <set_value name="$TagSelected" weight="1 + $CWeight" exact="tag.carrier" />
                        </do_any>
                        <do_if value="not $ShipSpawnZone.exists">
                            <set_value name="$ShipSpawnZone" exact="$TeleportationBeacons.random" />
                        </do_if>
                        <set_value name="$tagspawn" exact="$TagSelected" />
                        <!-- lib -->
                        <include_actions ref="SpawnShipsLIB" />
                        <set_value name="$ForcePool" exact="1" operation="subtract" />
                        <do_if value="$ForcePool ge 0 and $ForcePool le 1">
                            <do_all exact="$SpawnedShip.count" counter="$current">
                                <do_if value="$SearchComplete == false">
                                    <do_if value="$SpawnedShip.{$current}.isclass.[class.ship_xl]">
                                        <set_value name="$SearchComplete" exact="true" />
                                        <set_value name="$LeaderSelected" exact="$SpawnedShip.{$current}" />
                                    </do_if>
                                    <do_if value="$SpawnedShip.{$current}.isclass.[class.ship_l]">
                                        <set_value name="$LargeSearchComplete" exact="true" />
                                        <set_value name="$LeaderSelected" exact="$SpawnedShip.{$current}" />
                                    </do_if>
                                    <do_if value="$LargeSearchComplete == false">
                                        <do_if value="$SpawnedShip.{$current}.isclass.[class.ship_m]">
                                            <set_value name="$MediumSearchComplete" exact="true" />
                                            <set_value name="$LeaderSelected" exact="$SpawnedShip.{$current}" />
                                        </do_if>
                                        <do_if value="$MediumSearchComplete == false">
                                            <do_if value="$SpawnedShip.{$current}.isclass.[class.ship_s]">
                                                <set_value name="$LeaderSelected" exact="$SpawnedShip.{$current}" />
                                            </do_if>
                                        </do_if>
                                    </do_if>
                                </do_if>
                            </do_all>
                            <set_object_commander object="$LeaderSelected" commander="$LeaderSelected" />
                            <create_order id="'Patrol'" object="$LeaderSelected" default="true">
                                <param name="space" value="$SectorSelected" />
                            </create_order>
                            <remove_from_group group="$SpawnedShip" object="$LeaderSelected" />
                            <do_all exact="$SpawnedShip.count" counter="$follower">
                                <set_object_commander object="$SpawnedShip.{$follower}" commander="$LeaderSelected" />
                                <create_order id="'Escort'" object="$SpawnedShip.{$follower}" default="true">
                                    <param name="target" value="$LeaderSelected" />
                                    <param name="formation" value="formationshape.pointguard" />
                                    <param name="formationparam" value="200m" />
                                </create_order>
                            </do_all>
                            <add_to_group groupname="$SpawnedShip" object="$LeaderSelected" />
                            <set_value name="$NewEntry" exact="$FleetTable.keys.list.max + 1" />
                            <debug_text text="'MonkeyTest KeysMax ' + $FleetTable.keys.list.max" />
                            <set_value name="$FleetTable.{$NewEntry}" exact="table[
                                    $Beacon = $ShipSpawnZone,
                                    $Active = true,
                                    $FleetHop = true,
                                    $PirateHop = false,
                                    $PlayerAttack = false,
                                    $Invasion = false,
                                    $Startime = player.age,
                                    $Quant = $ForcePool,
                                    $FleetShips = $SpawnedShip
                                    ]" />
                            <remove_value name="$SpawnedShip" />
                            <remove_value name="$LeaderSelected" />
                            <remove_value name="$MediumSearchComplete" />
                            <remove_value name="$SearchComplete" />
                            <remove_value name="$LargeSearchComplete" />
                            <remove_value name="$ShipSpawnZone" />
                            <!-- <cancel_cue cue="this" /> -->
                        </do_if>
                        <debug_text text="'MonkeyTest FleetTable Beacon ' + $FleetTable.{1}.$Beacon" />
                        <debug_text text="'MonkeyTest FleetTable ShipsTable ' + $FleetTable.{1}.$FleetShips" />
                        <debug_text text="'MonkeyTest FleetTable Ship Name ' + $FleetTable.{1}.$FleetHop" />
                        <debug_text text="'$ForcePool test' + $ForcePool" />
                        <do_if value="$ForcePool ge 1">
                            <signal_cue_instantly cue="SignallerXenonFleetHop" />
                        </do_if>
                    </actions>
                </cue>
                <cue name="SignallerXenonFleetHop" instantiate="true">
                    <conditions>
                        <event_cue_signalled />
                    </conditions>
                    <actions>
                        <signal_cue_instantly cue="XenonFleetHop" />
                    </actions>
                </cue>
                <cue name="XenonInvasion" instantiate="true">
                    <conditions>
                        <event_cue_signalled />
                    </conditions>
                    <delay exact="3s" />
                    <actions>
                        <debug_to_file text="'INVASTION FLEET SIGNALLED '" name="'AIvalue.log'" />
                        <set_value name="$FactionSelected" exact="faction.xenon" />
                        <set_value name="$Owner" exact="faction.player" />
                        <set_value name="$FighterWeight" exact="50" />
                        <set_value name="$MWeight" exact="10" />
                        <set_value name="$UWeight" exact="2" />
                        <set_value name="$DWeight" exact="4" />
                        <set_value name="$CWeight" exact="1" />
                        <do_any>
                            <set_value name="$TagSelected" weight="1 + $FighterWeight" exact="tag.fighter" />
                            <set_value name="$TagSelected" weight="1 + $FighterWeight" exact="tag.fighter" />
                            <set_value name="$TagSelected" weight="1 + $FighterWeight" exact="tag.fighter" />
                            <set_value name="$TagSelected" weight="1 + $FighterWeight" exact="tag.fighter" />
                            <set_value name="$TagSelected" weight="1 + $MWeight" exact="tag.medium" />
                            <set_value name="$TagSelected" weight="1 + $UWeight" exact="tag.miner" />
                            <set_value name="$TagSelected" weight="1 + $DWeight" exact="tag.destroyer" />
                            <set_value name="$TagSelected" weight="1 + $CWeight" exact="tag.carrier" />
                        </do_any>
                        <do_if value="not $ShipSpawnZone.exists">
                            <set_value name="$ShipSpawnZone" exact="$TeleportationStations.random" />
                        </do_if>
                        <set_value name="$tagspawn" exact="$TagSelected" />
                        <!-- lib -->
                        <include_actions ref="SpawnShipsLIB" />
                        <set_value name="$ForcePool" exact="1" operation="subtract" />
                        <do_if value="$ForcePool ge 0 and $ForcePool le 1">
                            <do_all exact="$SpawnedShip.count" counter="$current">
                                <do_if value="$SearchComplete == false">
                                    <do_if value="$SpawnedShip.{$current}.isclass.[class.ship_xl]">
                                        <set_value name="$SearchComplete" exact="true" />
                                        <set_value name="$LeaderSelected" exact="$SpawnedShip.{$current}" />
                                    </do_if>
                                    <do_if value="$SpawnedShip.{$current}.isclass.[class.ship_l]">
                                        <set_value name="$LargeSearchComplete" exact="true" />
                                        <set_value name="$LeaderSelected" exact="$SpawnedShip.{$current}" />
                                    </do_if>
                                    <do_if value="$LargeSearchComplete == false">
                                        <do_if value="$SpawnedShip.{$current}.isclass.[class.ship_m]">
                                            <set_value name="$MediumSearchComplete" exact="true" />
                                            <set_value name="$LeaderSelected" exact="$SpawnedShip.{$current}" />
                                        </do_if>
                                        <do_if value="$MediumSearchComplete == false">
                                            <do_if value="$SpawnedShip.{$current}.isclass.[class.ship_s]">
                                                <set_value name="$LeaderSelected" exact="$SpawnedShip.{$current}" />
                                            </do_if>
                                        </do_if>
                                    </do_if>
                                </do_if>
                            </do_all>
                            <set_object_commander object="$LeaderSelected" commander="$LeaderSelected" />
                            <create_order id="'Patrol'" object="$LeaderSelected" default="true">
                                <param name="space" value="$SectorSelected" />
                            </create_order>
                            <remove_from_group group="$SpawnedShip" object="$LeaderSelected" />
                            <do_all exact="$SpawnedShip.count" counter="$follower">
                                <set_object_commander object="$SpawnedShip.{$follower}" commander="$LeaderSelected" />
                                <create_order id="'Escort'" object="$SpawnedShip.{$follower}" default="true">
                                    <param name="target" value="$LeaderSelected" />
                                    <param name="formation" value="formationshape.pointguard" />
                                    <param name="formationparam" value="200m" />
                                </create_order>
                            </do_all>
                            <add_to_group groupname="$SpawnedShip" object="$LeaderSelected" />
                            <set_value name="$NewEntry" exact="$FleetTable.keys.list.max + 1" />
                            <debug_text text="'MonkeyTest KeysMax ' + $FleetTable.keys.list.max" />
                            <set_value name="$FleetTable.{$NewEntry}" exact="table[
                                    $Beacon = $ShipSpawnZone,
                                    $Active = true,
                                    $FleetHop = false,
                                    $PirateHop = false,
                                    $PlayerAttack = false,
                                    $Invasion = true,
                                    $Startime = player.age,
                                    $Quant = $ForcePool,
                                    $FleetShips = $SpawnedShip
                                    ]" />
                            <remove_value name="$SpawnedShip" />
                            <remove_value name="$LeaderSelected" />
                            <remove_value name="$MediumSearchComplete" />
                            <remove_value name="$SearchComplete" />
                            <remove_value name="$LargeSearchComplete" />
                            <remove_value name="$ShipSpawnZone" />
                            <!-- <cancel_cue cue="this" /> -->
                        </do_if>
                        <debug_text text="'MonkeyTest FleetTable Beacon ' + $FleetTable.{1}.$Beacon" />
                        <debug_text text="'MonkeyTest FleetTable ShipsTable ' + $FleetTable.{1}.$FleetShips" />
                        <debug_text text="'MonkeyTest FleetTable Ship Name ' + $FleetTable.{1}.$FleetHop" />
                        <debug_text text="'$ForcePool test' + $ForcePool" />
                        <do_if value="$ForcePool ge 1">
                            <signal_cue_instantly cue="SignallerXenonInvasion" />
                        </do_if>
                    </actions>
                </cue>
                <cue name="SignallerXenonInvasion" instantiate="true">
                    <conditions>
                        <event_cue_signalled />
                    </conditions>
                    <actions>
                        <signal_cue_instantly cue="XenonInvasion" />
                    </actions>
                </cue>
                <library name="SpawnShipsLIB" instantiate="true">
                    <actions>
                        <create_ship name="$ShipSpawned" groupname="$SpawnedShip" zone="$ShipSpawnZone.zone">
                            <select faction="$FactionSelected" tags="[$tagspawn]" />
                            <loadout>
                                <level exact="1" />
                            </loadout>
                            <owner exact="$Owner" overridenpc="true" />
                            <safepos min="1km" max="4km" />
                        </create_ship>
                    </actions>
                </library>
                <library name="SpawnStationLIB" instantiate="true">
                    <actions>
                        <create_station groupname="$SpawnedStationGroup" name="$StationSpawned" macro="$StationMacro" sector="$SectorToSpawnIn" constructionplan="'$ConstructionPlan'" owner="$ConstructionFaction" state="componentstate.operational">
                            <safepos min="-100km" max="100km" />
                        </create_station>
                        <create_cue_actor cue="this" name="$Manager">
                            <select race="race.teladi" tags="controlpost.manager.tag" />
                            <owner exact="faction.argon" />
                            <skills>
                                <skill type="management" exact="1" />
                            </skills>
                        </create_cue_actor>
                        <create_cue_actor cue="this" name="$Def">
                            <select race="race.drone" tags="tag.defence" />
                            <owner exact="faction.argon" />
                            <skills>
                                <skill type="management" exact="1" />
                            </skills>
                        </create_cue_actor>
                        <create_cue_actor cue="this" name="$Eng">
                            <select race="race.drone" tags="tag.engineer" />
                            <owner exact="faction.argon" />
                            <skills>
                                <skill type="management" exact="1" />
                            </skills>
                        </create_cue_actor>
                        <debug_text text="$Manager.knownname" />
                        <assign_control_entity object="$StationSpawned" actor="$Manager" post="controlpost.manager" transfer="true" />
                        <assign_control_entity object="$StationSpawned" actor="$Def" post="controlpost.defence" transfer="true" />
                        <assign_control_entity object="$StationSpawned" actor="$Eng" post="controlpost.engineer" transfer="true" />
                        <add_workforce object="$StationSpawned" race="race.argon" exact="500" />
                        <set_object_docking_enabled object="$StationSpawned" enabled="true" />
                        <remove_value name="$Manager" />
                        <remove_value name="$Def" />
                        <remove_value name="$Eng" />
                        <debug_to_file text="'StationSpawned ' + $StationSpawned.knownname" name="'SpawnStationLIB.log'" />
                        <debug_to_file text="'StationSpawned - productions ' + $StationSpawned.productions" name="'SpawnStationLIB.log'" />
                        <debug_to_file text="'StationSpawned - cargofree' + $StationSpawned.cargo.free" name="'SpawnStationLIB.log'" />
                        <debug_to_file text="'StationSpawned - controlposts' + $StationSpawned.controlposts.all" name="'SpawnStationLIB.log'" />
                        <debug_to_file text="'StationSpawned - controlpostsfree' + $StationSpawned.controlposts.free" name="'SpawnStationLIB.log'" />
                    </actions>
                </library>
                <library name="SpawnFactoryLIB" instantiate="true">
                    <actions>
                        <find_zone groupname="$zones" multiple="true" space="$SectorToSpawnIn" />
                        <create_station groupname="$SpawnedFactoriesGroup" name="$FactorySpawned" state="componentstate.operational" macro="macro.station_gen_factory_base_01_macro" zone="$zones.random" owner="faction.argon">
                            <safepos min="-100km" max="100km" />
                        </create_station>
                        <extend_build_plot object="$FactorySpawned" negx="10km" negz="10km" negy="10km" posy="10km" posx="10km" posz="10km" />
                        <get_suitable_storage_modules macros="$Stor" production="$Prod" result="$Storage" />
                        <do_all exact="$Storage.count" counter="$thisstor">
                            <append_to_list name="$Prod" exact="$Storage.{$thisstor}" />
                        </do_all>
                        <create_construction_sequence station="$FactorySpawned" connectors="$Con" macros="$Prod">
                            <immediate result="$Sequen" />
                        </create_construction_sequence>
                        <apply_construction_sequence station="$FactorySpawned" sequence="$Sequen" />
                        <create_cue_actor cue="this" name="$Manager">
                            <select race="race.teladi" tags="controlpost.manager.tag" />
                            <owner exact="faction.argon" />
                            <skills>
                                <skill type="management" exact="1" />
                            </skills>
                        </create_cue_actor>
                        <create_cue_actor cue="this" name="$Def">
                            <select race="race.drone" tags="tag.defence" />
                            <owner exact="faction.argon" />
                            <skills>
                                <skill type="management" exact="1" />
                            </skills>
                        </create_cue_actor>
                        <create_cue_actor cue="this" name="$Eng">
                            <select race="race.drone" tags="tag.engineer" />
                            <owner exact="faction.argon" />
                            <skills>
                                <skill type="management" exact="1" />
                            </skills>
                        </create_cue_actor>
                        <debug_text text="$Manager.knownname" />
                        <assign_control_entity object="$FactorySpawned" actor="$Manager" post="controlpost.manager" transfer="true" />
                        <assign_control_entity object="$FactorySpawned" actor="$Def" post="controlpost.defence" transfer="true" />
                        <assign_control_entity object="$FactorySpawned" actor="$Eng" post="controlpost.engineer" transfer="true" />
                        <set_object_docking_enabled object="$FactorySpawned" enabled="true" />
                        <add_workforce object="$FactorySpawned" race="race.argon" exact="500" />
                        <remove_value name="$zones" />
                        <remove_value name="$Prod" />
                        <remove_value name="$Con" />
                        <remove_value name="$Stor" />
                        <remove_value name="$Manager" />
                        <remove_value name="$Def" />
                        <remove_value name="$Eng" />
                        <debug_to_file text="'FactorySpawned ' + $FactorySpawned.knownname" name="'SpawnFactoryLIB.log'" />
                        <debug_to_file text="'FactorySpawned - productions ' + $FactorySpawned.productions" name="'SpawnFactoryLIB.log'" />
                        <debug_to_file text="'FactorySpawned - cargofree' + $FactorySpawned.cargo.free" name="'SpawnFactoryLIB.log'" />
                        <debug_to_file text="'FactorySpawned - controlposts' + $FactorySpawned.controlposts.all" name="'SpawnFactoryLIB.log'" />
                        <debug_to_file text="'FactorySpawned - controlpostsfree' + $FactorySpawned.controlposts.free" name="'SpawnFactoryLIB.log'" />
                    </actions>
                </library>
            </cues>
        </cue>
    </cues>
</mdscript>